# 表单API需求文档

## 项目概述
开发一个简单的API接口，用于接收浏览器提交的表单数据，并将接收到的信息以JSON格式返回，用于检查前端发送的内容。

## 功能需求

### 1. 接收表单数据
- **输入方式**: 支持POST请求接收表单数据
- **数据格式**: 支持以下格式的表单数据：
  - `application/x-www-form-urlencoded` (标准HTML表单)
  - `application/json` (JSON格式数据)

### 2. 表单字段
- **username**: 用户账号
- **password**: 用户密码
- **token**: 认证令牌（可选）

### 3. 数据处理
- 解析接收到的表单数据
- 将数据转换为JSON格式

### 4. 返回响应
- **响应格式**: JSON格式
- **响应内容**: 直接返回接收到的表单数据

## 技术规范

### API端点
- **URL**: `/api/form`
- **方法**: POST
- **Content-Type**: 支持多种格式

### 请求示例

#### HTML表单格式
```http
POST /api/form HTTP/1.1
Content-Type: application/x-www-form-urlencoded

username=zhangsan&password=123456&token=abc123
```

#### JSON格式
```http
POST /api/form HTTP/1.1
Content-Type: application/json

{
  "username": "zhangsan",
  "password": "123456",
  "token": "abc123"
}
```

### 响应示例
```json
{
  "username": "zhangsan",
  "password": "123456",
  "token": "abc123"
}
```

## 测试用例

### 测试场景
1. 发送包含username和password的HTML表单数据
2. 发送包含username、password和token的HTML表单数据
3. 发送JSON格式的认证数据
4. 发送只包含username和password的JSON数据（无token）

---

## 注册功能实现记录

### 功能描述
实现了用户注册API，接收用户名和密码，使用argon2加密密码，生成token并返回给前端。

### API端点
- **URL**: `/auth/register`
- **方法**: POST
- **Content-Type**: application/json

### 请求格式
```json
{
  "username": "aaa",
  "password": "bbb",
  "requestType": "register"
}
```

### 响应格式
```json
{
  "status": "success",
  "message": "注册成功",
  "token": "20f5ff5195687101e4abcbba413f9970",
  "username": "aaaa"
}
```

### 实现细节
1. **密码加密**: 使用argon2算法对密码进行加密
2. **Token生成**: 使用`secrets.token_hex(16)`生成32字符的安全随机token
3. **参数验证**: 验证username、password和requestType字段
4. **错误处理**: 包含基本的错误处理和响应

### 测试结果
- ✅ 成功接收JSON格式的注册请求
- ✅ 正确验证必需参数
- ✅ 密码使用argon2加密
- ✅ 生成32字符的安全token
- ✅ 返回包含token的JSON响应

### 文件结构
- `module/auth.py`: 包含`register_user()`函数
- `app.py`: 包含`/auth/register`路由处理
- 依赖模块: `password_hash.py`, `generate_token.py`